<div class="container my-3">

  <!-- Add / Edit Form -->
  <div *ngIf="isemployeeForm" class="card shadow p-3">
    <h4 class="mb-3">{{ isEdit ? 'Edit Employee' : 'Add Employee' }}</h4>

    <form [formGroup]="employeeForm" (ngSubmit)="submit()" novalidate>
      <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Photo</label>
        <input type="file" class="form-control" (change)="onFileSelected($event)" />
        <div *ngIf="selectedEmployee?.imagePath" class="mt-2">
          <img [src]="photoUrl + selectedEmployee.imagePath" width="80" height="80" class="rounded">
        </div>
      </div>

        <div class="col-md-6">
          <label class="form-label">Name *</label>
          <input class="form-control" formControlName="name" />
          <div class="text-danger" *ngIf="employeeForm.controls['name'].touched && employeeForm.controls['name'].invalid">
            Name is required (min 3 chars)
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Designation *</label>
          <select class="form-select" formControlName="role">
            <option value="" disabled selected>Select Designation</option>
            <option *ngFor="let d of designations" [value]="d">{{ d }}</option>
          </select>
          <div class="text-danger" *ngIf="employeeForm.controls['role'].touched && employeeForm.controls['role'].invalid">
            Designation is required
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Mobile 1 *</label>
          <input class="form-control" formControlName="mobile1" />
          <div class="text-danger" *ngIf="employeeForm.controls['mobile1'].touched && employeeForm.controls['mobile1'].invalid">
            Enter valid 10 digit number
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Mobile 2</label>
          <input class="form-control" formControlName="mobile2" />
        </div>

        <div class="col-md-6">
          <label class="form-label">Salary *</label>
          <input type="number" class="form-control" formControlName="monthlySalary" />
          <div class="text-danger" *ngIf="employeeForm.controls['monthlySalary'].touched && employeeForm.controls['monthlySalary'].invalid">
            Salary must be at least 1000
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Aadhaar *</label>
          <input class="form-control" formControlName="aadhaar" />
          <div class="text-danger" *ngIf="employeeForm.controls['aadhaar'].touched && employeeForm.controls['aadhaar'].invalid">
            Aadhaar must be 12 digits
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">PAN Card</label>
          <input class="form-control" formControlName="panCard" (input)="toUpperCase($event)" style="text-transform: uppercase"  />
          <div class="text-danger" *ngIf="employeeForm.controls['panCard'].touched && employeeForm.controls['panCard'].invalid">
            Invalid PAN format
          </div>
        </div>

        <div class="col-12">
          <label class="form-label">Address</label>
          <textarea class="form-control" formControlName="address"></textarea>
        </div>
         <div class="col-md-6">
          <label class="form-label">Village</label>
          <input class="form-control" formControlName="village" />
        </div>
        <div class="col-md-6">
          <label class="form-label">Taluka</label>
          <input class="form-control" formControlName="taluka" />
        </div>

        <div class="col-md-6">
          <label class="form-label">District</label>
          <input class="form-control" formControlName="district" />
        </div>

        <div class="col-md-6">
          <label class="form-label">State</label>
          <input class="form-control" formControlName="state" />
        </div>
      </div>

      <div class="mt-3">
        <button type="submit" class="btn btn-success me-2">{{ isEdit ? 'Update' : 'Add' }}</button>
        <button type="button" class="btn btn-secondary" (click)="resetForm()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Employee Table -->
  <div *ngIf="!isemployeeForm" class="card shadow p-3 mt-3">
    <div class="d-flex justify-content-between align-items-center">
      <h4>Employee List</h4>
      <button class="btn btn-primary" (click)="addNew()">Add New</button>
    </div>

    <div *ngIf="loading" class="text-info my-2">Loading...</div>

    <div class="table-responsive mt-3" *ngIf="employees.length">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Salary</th>
            <!-- <th>Aadhaar</th> -->
            <th>Designation</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let emp of employees; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ emp.name }}</td>
            <td>{{ emp.mobile1 }}</td>
            <td>{{ emp.monthlySalary | number:'1.0-0' }}</td>
            <!-- <td>{{ emp.aadhaar }}</td> -->
            <td>{{ emp.role }}</td>
            <td class="d-flex">
              <!-- View -->
              <button class="btn btn-sm btn-info me-1" (click)="viewEmployee(emp)">
                <i class="bi bi-eye"></i>
              </button>
              <!-- Edit -->
              <button class="btn btn-sm btn-warning me-1" (click)="edit(emp)">
                <i class="bi bi-pencil"></i>
              </button>
              <!-- Delete -->
              <button class="btn btn-sm btn-danger" (click)="delete(emp.employeeId)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && !employees.length" class="text-muted">No employees found.</div>
  </div>

  <!-- Employee Details Modal -->
  <div class="custom-modal-backdrop" *ngIf="selectedEmployee"></div>
<div class="custom-modal" *ngIf="selectedEmployee">
  <div class="custom-modal-content">
    <h5>Employee Details</h5>
    <div *ngIf="selectedEmployee?.imagePath" class="mt-2">
          <img [src]="photoUrl + selectedEmployee.imagePath" width="80" height="80" class="rounded">
        </div>
    <p><strong>Name:</strong> {{ selectedEmployee.name }}</p>
    <p><strong>Designation:</strong> {{ selectedEmployee.role }}</p>
    <p><strong>Mobile:</strong> {{ selectedEmployee.mobile1 }}</p>
    <p><strong>Salary:</strong> {{ selectedEmployee.monthlySalary | currency:'INR' }}</p>
    <p><strong>Factory:</strong> {{ selectedEmployee.factoryName }}</p>
    <p><strong>Aadhaar:</strong> {{ selectedEmployee.aadhaar }}</p>
    <p><strong>Address:</strong> {{ selectedEmployee.address }}</p>
      <p><strong>Village:</strong> {{ selectedEmployee.village }}</p>
     <p><strong>Talika:</strong> {{ selectedEmployee.taluka }}</p>
    <p><strong>District:</strong> {{ selectedEmployee.district }}</p>
    <p><strong>State:</strong> {{ selectedEmployee.state }}</p>
     <p><strong>Advance:</strong> {{ selectedEmployee.advanceBalance }}</p>

    <div class="text-end">
      <button class="btn btn-secondary" (click)="closeModal()">Close</button>
    </div>
  </div>
</div>


</div>
