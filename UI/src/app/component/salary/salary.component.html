<div class="mt-4">
  <div class="input-group input-group-sm">
    <span class="input-group-text" id="search-addon">
      <span class="material-symbols-outlined">search</span>
    </span>
    <input
      type="text"
      class="form-control"
      placeholder="Search employees..."
      [(ngModel)]="searchText"
      (input)="filterEmployees()"
      (focus)="isSearchFocused = true"
      (blur)="isSearchFocused = false"
      aria-label="Search"
      aria-describedby="search-addon"
    />
  </div>
</div>
<div class="salary-container card">
  <h2>Salary Management</h2>

<div class="table-responsive mt-2">
  <table class="table table-striped table-bordered table-sm">
    <thead class="table-light">
      <tr>
        <th>Sr No</th>
        <th>Name</th>
        <th>Designation</th>
        <th>Salary</th>
        <th>Advance</th>
        <th>Status</th>
        <th>Net Payable</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let emp of filteredEmployees; trackBy: trackByEmployee">
        <td>{{ emp.id }}</td>
        <td>{{ emp.name }}</td>
        <td>{{ emp.designation }}</td>
        <td>₹{{ emp.salary | number }}</td>
        <td class="text-warning">₹{{ emp.advance | number }}</td>
        <td>
          <span
            [ngClass]="{
              'badge bg-success': emp.status === 'Paid',
              'badge bg-danger': emp.status === 'Pending'
            }"
          >
            {{ emp.status }}
          </span>
        </td>
        <td>₹{{ emp.salary - emp.advance }}</td>
        <td>
          <button
            class="btn btn-sm btn-outline-primary"
            (click)="openSalaryPopup(emp)"
          >
            <span class="material-symbols-outlined">edit</span>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
  <!-- ✅ Salary Generate Form -->
  <form [formGroup]="form" (ngSubmit)="generateSalary()" class="generate-form">
    <div class="form-group">
      <label>Employee ID</label>
      <input type="number" formControlName="employeeId" placeholder="Enter Employee ID" />
    </div>

<div class="alert alert-info p-2 small mt-2">
  Pending Salaries: <strong>{{ pendingCount }}</strong>
</div>
<div class="custom-popup" *ngIf="isSalaryPopupOpen">
  <div class="custom-popup-content">
    <h5>Manage Salary</h5>
    <div *ngIf="selectedEmployee">
      <p>
        <strong>{{ selectedEmployee.name }}</strong>
      </p>
      <p>Designation: {{ selectedEmployee.designation }}</p>
      <div class="mb-2">
        <label>Salary:</label>
        <input
          type="number"
          class="form-control form-control-sm"
          [(ngModel)]="selectedEmployee.salary"
        />
      </div>
      <div class="mb-2">
        <label>Advance:</label>
        <input
          type="number"
          class="form-control form-control-sm"
          [(ngModel)]="selectedEmployee.advance"
        />
      </div>
      <p>
        <strong
          >Net Payable: ₹{{
            selectedEmployee.salary - selectedEmployee.advance
          }}</strong
        >
      </p>
      <p>Status: {{ selectedEmployee.status }}</p>
    <div class="form-group">
      <label>Start Date</label>
      <input type="date" formControlName="startDate" />
    </div>
    <div class="d-flex justify-content-end gap-2 mt-3">
      <button class="btn btn-secondary btn-sm" (click)="closeSalaryPopup()">
        Close
      </button>
      <button class="btn btn-primary btn-sm" (click)="saveSalaryChanges()">
        Save
      </button>

    <div class="form-group">
      <label>End Date</label>
      <input type="date" formControlName="endDate" />
    </div>
  </div>
</div>

<!-- <div class="row">
  <div class="col-12 col-sm-6 col-md-4 mb-3" *ngFor="let emp of employees; trackBy: trackByEmployee">
    <div class="card h-100" [ngClass]="{'border-danger': emp.status==='Pending', 'border-success': emp.status==='Paid'}">
      <div class="card-body">
        <h5 class="card-title">{{ emp.name }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">{{ emp.designation }}</h6>
        <p class="mb-1">Salary: ₹{{ emp.salary | number }}</p>
        <p class="mb-1 text-warning">Advance: ₹{{ emp.advance | number }}</p>
        <p class="mb-1">Net Payable: ₹{{ emp.salary - emp.advance }}</p>
        <p>
          Status: 
          <span [ngClass]="{'text-success': emp.status==='Paid','text-danger': emp.status==='Pending'}">
            {{ emp.status }}
          </span>
        </p>
        <button class="btn btn-sm btn-outline-primary" (click)="openSalaryPopup(emp)">
          <span class="material-symbols-outlined">edit</span> Manage
        </button>
      </div>
    <button type="submit" [disabled]="submitting">Generate Salary</button>
  </form>

  <div *ngIf="message" class="success">{{ message }}</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <hr />

  <!-- ✅ Salary List -->
  <div class="salary-list">
    <h3>Salary Transactions</h3>

    <div *ngIf="loading" class="info">Loading...</div>
    <table *ngIf="!loading && salaries.length" class="salary-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Emp ID</th>
          <th>Start</th>
          <th>End</th>
          <th>Present</th>
          <th>Half</th>
          <th>Total</th>
          <th>Advance</th>
          <th>Final</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of salaries; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ s.employeeId }}</td>
          <td>{{ s.startDate | date }}</td>
          <td>{{ s.endDate | date }}</td>
          <td>{{ s.presentDays }}</td>
          <td>{{ s.halfDays }}</td>
          <td>{{ s.totalSalary | number:'1.2-2' }}</td>
          <td>{{ s.advanceDeducted | number:'1.2-2' }}</td>
          <td>{{ s.finalSalary | number:'1.2-2' }}</td>
          <td>{{ s.date | date:'short' }}</td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && !salaries.length" class="info">
      No salary transactions found.
    </div>
  </div>
</div> -->
</div>


