<div class="attendance-report-new">
  <!-- Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold d-flex align-items-center justify-content-center gap-2">
      <i class="bi bi-calendar-check"></i> Attendance Report
    </h2>
    <p class="text-muted">Generate comprehensive attendance reports with PDF export</p>
  </div>

  <!-- Report Filters -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form class="row g-3 align-items-end">

        <!-- Quick Filters -->
        <div class="col-12 d-flex gap-2 flex-wrap mb-2">
          <button type="button" class="btn btn-outline-primary btn-sm" (click)="setDateRange('thisMonth')">This Month</button>
          <button type="button" class="btn btn-outline-primary btn-sm" (click)="setDateRange('lastMonth')">Last Month</button>
          <button type="button" class="btn btn-outline-primary btn-sm" (click)="setDateRange('last7')">Last 7 Days</button>
        </div>

        <!-- From Date -->
        <div class="col-6 col-md-3">
          <label class="form-label fw-semibold">From Date</label>
          <input class="form-control" type="date" [(ngModel)]="fromDate" name="fromDate" [max]="maxDate">
        </div>

        <!-- To Date -->
        <div class="col-6 col-md-3">
          <label class="form-label fw-semibold">To Date</label>
          <input class="form-control" type="date" [(ngModel)]="toDate" name="toDate" [max]="maxDate">
        </div>

        <!-- Employee Code -->
        <div class="col-6 col-md-3">
          <label class="form-label fw-semibold">Employee Code (Optional)</label>
          <input type="text" class="form-control" [(ngModel)]="employeeCode" name="employeeCode" placeholder="E101">
        </div>

        <!-- Actions -->
        <div class="col-6 col-md-3 d-flex gap-2">
          <button type="button" class="btn btn-dark flex-fill" (click)="fetchReport()" [disabled]="loading">
            {{ loading ? 'Loading...' : 'Get Report' }}
          </button>
          <button type="button" class="btn btn-outline-success flex-fill" (click)="downloadReportPdf()" [disabled]="isGeneratingPdf || reportData.length === 0">
            â¬‡ PDF
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Attendance Table -->
  <div class="card shadow-sm mb-3" *ngIf="reportData.length > 0">
    <div class="card-body attendance-table table-responsive" #reportContent>
      <table class="table table-sm align-middle text-center mb-0" style="border-collapse: collapse; border: 1px solid #6c757d; min-width: 900px;">
        <thead>
          <tr class="table-light">
            <th class="sticky-col-1" style="border: 1px solid #6c757d; border-right: 2px solid #6c757d;">Sr.</th>
            <th class="sticky-col-2 text-start" style="border: 1px solid #6c757d; border-right: 2px solid #6c757d;">Employee</th>
            <th *ngFor="let day of [].constructor(daysInMonth); let i=index" style="border: 1px solid #6c757d; min-width: 35px;">{{ i+1 }}</th>
            <th class="summary-col text-danger" style="border: 1px solid #6c757d;">Absent</th>
            <th class="summary-col text-success" style="border: 1px solid #6c757d;">Present</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let emp of reportData; let i=index" [ngClass]="{'table-secondary': i % 2 === 1}">
            <td class="sticky-col-1" style="border: 1px solid #6c757d; border-right: 2px solid #6c757d;">{{ i+1 }}</td>
            <td class="sticky-col-2 text-start" style="border: 1px solid #6c757d; border-right: 2px solid #6c757d;">
              <div class="fw-semibold">{{ emp.employeeName }}</div>
              <small class="text-muted">{{ emp.employeeCode }}</small>
            </td>
            <td *ngFor="let day of emp.days"
                [ngClass]="{
                  'present': day === 'P',
                  'absent': day === 'A',
                  'halfday': day === 'H',
                  'not-marked': day === 'NA'
                }"
                style="border: 1px solid #6c757d; font-weight: bold;">
              {{ day === 'NA' ? '-' : day }}
            </td>
            <td class="fw-bold text-danger" style="border: 1px solid #6c757d;">{{ emp.absentCount }}</td>
            <td class="fw-bold text-success" style="border: 1px solid #6c757d;">{{ emp.presentCount }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Legend -->
  <div class="d-flex gap-4 flex-wrap small mt-3" *ngIf="reportData.length > 0">
    <span><span class="legend present">P</span> Present</span>
    <span><span class="legend absent">A</span> Absent</span>
    <span><span class="legend halfday">H</span> Half Day</span>
    <span><span class="legend not-marked">-</span> Not Marked</span>
  </div>
</div>